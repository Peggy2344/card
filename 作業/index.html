<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Document</title>
        <link href="https://fonts.googleapis.com/css2?family=Permanent+Marker&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="style.css">
    </head>
    <body>
        <div id="container">
            <div id="record_area">
                <p id='lev'>LEVEL<span id='level'>1</span></p>
                <p id="sc">score<span class='score'>0</span></p>
                <div id="start"><button id='btn_start'>start</button></div>
                <p id="ti">time<span id='time'>30</span></p>
            </div>
            <div id="next">

                <div><p id="congra">PERFECT</p></div>
                <div><p id="level_score">your score:</p><p class='score'>0</p></div>
                <div id="nextBar"><button id="btn_next">Next</button></div>
            </div>
            <div id="game_area">
                <div id="cards"></div>
            </div>
        </>
        <script src="./jquery-3.5.1.min.js"></script>
        <script>
            let checkPoint = 2;
            let level = 1;
            let bg = 1;
            function createCards(row){
                let order = 0;
                let totalCard = checkPoint % 2 === 0 ? Math.pow(row,2) : Math.pow(row,2)-1
                for(let i=0;i<totalCard;i++){
                    $('#cards').append(`
                    <div class='card close'>
                        <div class='back'></div>
                        <div class='front'></div>
                        </div>
                        `)
                    let num = order % Math.round(totalCard/2) + 1
                    $('.back').css('background-image',`url(./cards/${bg}.jpg)`)
                    $('.card')
                    .eq(order)
                    .find('.front')
                    .css('background-image',`url(./cards/${num}S.jpg)`)
                    $('.card').eq(order).attr('data-num',`${num}`)
                    order++
                    const target = Math.floor(Math.random()*totalCard)
                    $('.card').eq(target).insertAfter($('.card').eq(order-1))
                }
                for(let k=row-1;k<totalCard;k+=row){
                    $(`<div class='block'></div>`).insertAfter($('.card').eq(k))
                }
                bg++
            }
            function next(){
                $('#next').css('display','none')
                checkPoint++
                createCards(checkPoint)
                level++
                $('#level').text(level)
            }
            $('#cards').on('click','.card',function(){
                if($('.card:not(.close)').length < 2){
                    $(this).removeClass('close')
                }
                if($('.card:not(.close)').length === 2){
                    if(
                    $('.card:not(.close)').eq(0).attr('data-num') === 
                    $('.card:not(.close)').eq(1).attr('data-num')){
                        $('.card:not(.close)').fadeTo(500,0).addClass('clear')
                    }
                    setTimeout(()=>{
                    $('.card:not(.close.clear)').addClass('close')
                    },600)
                }
                
                if($('.clear').length === $('.card').length){
                    setTimeout(()=>{
                    $('#cards').empty()
                    },1000)
                    setTimeout(() => {
                        console.log('win');
                    $('#next').css('display','flex')
                }, 2000)
                }
            })
            
            $('#btn_start').on('click',function(){
                createCards(checkPoint)
                $('#btn_start').attr('disabled',true)
            })
            $('#btn_next').on('click',next)
        </script>
    </body>
</html>
